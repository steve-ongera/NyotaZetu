{% extends 'admin_base.html' %}
{% load humanize %}

{% block title %}Process Disbursement - {{ allocation.application.application_number }}{% endblock %}

{% block content %}
<div class="page-container">
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="{% url 'constituency_dashboard' %}">Dashboard</a>
        <span class="separator">/</span>
        <a href="{% url 'constituency_disbursements' %}">Disbursements</a>
        <span class="separator">/</span>
        <span class="current">Process Disbursement</span>
    </nav>

    <!-- Page Header -->
    <div class="page-header">
        <h1>Process Disbursement</h1>
        <p>Application: {{ allocation.application.application_number }}</p>
    </div>

    <div class="content-grid">
        <!-- Main Form -->
        <div class="main-content">
            <div class="content-section">
                <h2>Disbursement Details</h2>
                
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="form-group">
                        <label for="payment_method">Payment Method</label>
                        <select name="payment_method" id="payment_method" class="form-control" required>
                            <option value="">Select payment method</option>
                            <option value="cheque">Cheque</option>
                            <option value="bank_transfer">Bank Transfer</option>
                            <option value="mpesa">M-Pesa</option>
                            <option value="bulk_cheque">Bulk Cheque</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="reference_number">Reference/Transaction Number</label>
                        <input type="text" name="reference_number" id="reference_number" 
                               class="form-control" required placeholder="Enter reference number">
                    </div>

                    <div class="form-group">
                        <label for="cheque_number">Cheque Number (if applicable)</label>
                        <input type="text" name="cheque_number" id="cheque_number" 
                               class="form-control" placeholder="Enter cheque number">
                    </div>

                    <div class="form-group">
                        <label for="disbursement_date">Disbursement Date</label>
                        <input type="date" name="disbursement_date" id="disbursement_date" 
                               class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label for="remarks">Remarks/Notes</label>
                        <textarea name="remarks" id="remarks" class="form-control" 
                                  rows="4" placeholder="Any additional remarks"></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="icon-check"></i> Process Disbursement
                        </button>
                        <a href="{% url 'constituency_disbursements' %}" class="btn btn-secondary">
                            Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Allocation Summary -->
            <div class="sidebar-section">
                <h3>Allocation Summary</h3>
                <div class="summary-list">
                    <div class="summary-item">
                        <label>Student</label>
                        <p>{{ allocation.application.applicant.user.get_full_name }}</p>
                    </div>
                    <div class="summary-item">
                        <label>ID Number</label>
                        <p>{{ allocation.application.applicant.id_number }}</p>
                    </div>
                    <div class="summary-item">
                        <label>Institution</label>
                        <p>{{ allocation.application.institution.name }}</p>
                    </div>
                    <div class="summary-item">
                        <label>Amount Allocated</label>
                        <p class="amount-highlight">KES {{ allocation.amount_allocated|floatformat:2|intcomma }}</p>
                    </div>
                    <div class="summary-item">
                        <label>Allocation Date</label>
                        <p>{{ allocation.allocation_date|date:"M d, Y" }}</p>
                    </div>
                    <div class="summary-item">
                        <label>Approved By</label>
                        <p>{{ allocation.approved_by.get_full_name }}</p>
                    </div>
                </div>
            </div>

            <!-- Institution Details -->
            <div class="sidebar-section">
                <h3>Institution Details</h3>
                <div class="summary-list">
                    {% if allocation.application.institution.bank_name %}
                    <div class="summary-item">
                        <label>Bank</label>
                        <p>{{ allocation.application.institution.bank_name }}</p>
                    </div>
                    {% endif %}
                    {% if allocation.application.institution.bank_branch %}
                    <div class="summary-item">
                        <label>Branch</label>
                        <p>{{ allocation.application.institution.bank_branch }}</p>
                    </div>
                    {% endif %}
                    {% if allocation.application.institution.account_number %}
                    <div class="summary-item">
                        <label>Account Number</label>
                        <p>{{ allocation.application.institution.account_number }}</p>
                    </div>
                    {% endif %}
                    {% if allocation.application.institution.phone_number %}
                    <div class="summary-item">
                        <label>Phone</label>
                        <p>{{ allocation.application.institution.phone_number }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Warnings -->
            <div class="sidebar-section alert-warning">
                <h3>Important Notes</h3>
                <ul>
                    <li>Verify all payment details before processing</li>
                    <li>Ensure reference number is unique</li>
                    <li>Confirm institution bank details are correct</li>
                    <li>Process will be logged for audit purposes</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}