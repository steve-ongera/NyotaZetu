{% extends 'admin_base.html' %}
{% load humanize %}

{% block title %}{{ ward.name }} Ward - Details{% endblock %}

{% block content %}
<div class="page-container">
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="{% url 'constituency_dashboard' %}">Dashboard</a>
        <span class="separator">/</span>
        <a href="{% url 'constituency_wards_overview' %}">Wards</a>
        <span class="separator">/</span>
        <span class="current">{{ ward.name }}</span>
    </nav>

    <!-- Page Header -->
    <div class="page-header">
        <div class="header-content">
            <h1>{{ ward.name }} Ward</h1>
            <p>{{ constituency.name }} Constituency</p>
        </div>
        <div class="header-actions">
            <a href="{% url 'constituency_wards_overview' %}" class="btn btn-secondary">
                <i class="icon-back"></i> Back to Wards
            </a>
        </div>
    </div>

    <!-- Ward Information -->
    <div class="content-section">
        <h2>Ward Information</h2>
        <div class="info-grid">
            {% if ward.current_mca %}
            <div class="info-item">
                <label>Current MCA</label>
                <p>{{ ward.current_mca }}</p>
            </div>
            {% endif %}

            {% if ward.mca_party %}
            <div class="info-item">
                <label>Party</label>
                <p>{{ ward.mca_party }}</p>
            </div>
            {% endif %}

            {% if ward.mca_phone %}
            <div class="info-item">
                <label>MCA Phone</label>
                <p>{{ ward.mca_phone }}</p>
            </div>
            {% endif %}

            {% if ward.mca_email %}
            <div class="info-item">
                <label>MCA Email</label>
                <p>{{ ward.mca_email }}</p>
            </div>
            {% endif %}

            {% if ward.population %}
            <div class="info-item">
                <label>Population</label>
                <p>{{ ward.population|intcomma }}</p>
            </div>
            {% endif %}

            {% if ward.ward_office_location %}
            <div class="info-item">
                <label>Ward Office</label>
                <p>{{ ward.ward_office_location }}</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Statistics -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="icon-applications"></i>
            </div>
            <div class="stat-content">
                <h3>{{ stats.total }}</h3>
                <p>Total Applications</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="icon-approved"></i>
            </div>
            <div class="stat-content">
                <h3>{{ stats.approved }}</h3>
                <p>Approved</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="icon-pending"></i>
            </div>
            <div class="stat-content">
                <h3>{{ stats.pending }}</h3>
                <p>Pending</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="icon-review"></i>
            </div>
            <div class="stat-content">
                <h3>{{ stats.under_review }}</h3>
                <p>Under Review</p>
            </div>
        </div>
    </div>

    <!-- Financial Summary -->
    <div class="content-section">
        <h2>Financial Summary</h2>
        <div class="financial-grid">
            <div class="financial-item">
                <label>Total Requested</label>
                <div class="amount">KES {{ financial.total_requested|floatformat:2|intcomma }}</div>
            </div>
            <div class="financial-item">
                <label>Total Allocated</label>
                <div class="amount">KES {{ financial.total_allocated|floatformat:2|intcomma }}</div>
            </div>
        </div>
    </div>

    <!-- Recent Applications -->
    <div class="content-section">
        <div class="section-header">
            <h2>Recent Applications</h2>
            <a href="{% url 'constituency_applications_list' %}?ward={{ ward.id }}" class="btn btn-link">
                View All Ward Applications
            </a>
        </div>

        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Application No.</th>
                        <th>Applicant</th>
                        <th>Institution</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for app in recent_apps %}
                    <tr>
                        <td>{{ app.application_number }}</td>
                        <td>{{ app.applicant.user.get_full_name }}</td>
                        <td>{{ app.institution.name|truncatewords:3 }}</td>
                        <td>KES {{ app.amount_requested|floatformat:2|intcomma }}</td>
                        <td>
                            <span class="badge badge-{{ app.status }}">{{ app.get_status_display }}</span>
                        </td>
                        <td>{{ app.date_submitted|date:"M d, Y"|default:"N/A" }}</td>
                        <td>
                            <a href="{% url 'constituency_application_detail' app.id %}" class="btn btn-sm">
                                View
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="text-center">
                            <div class="empty-state">
                                <p>No applications found for this ward.</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}