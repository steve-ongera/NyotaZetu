{% extends 'base.html' %}
{% load humanize %}

{% block title %}Settings - {{ constituency.name }}{% endblock %}

{% block content %}
<div class="page-container">
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="{% url 'constituency_dashboard' %}">Dashboard</a>
        <span class="separator">/</span>
        <span class="current">Settings</span>
    </nav>

    <!-- Page Header -->
    <div class="page-header">
        <h1>Constituency Settings</h1>
        <p>Manage {{ constituency.name }} Constituency Information</p>
    </div>

    <!-- Settings Form -->
    <div class="content-section">
        <h2>CDF Office Information</h2>
        
        <form method="post">
            {% csrf_token %}
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="current_mp">Current Member of Parliament</label>
                    <input type="text" name="current_mp" id="current_mp" class="form-control" 
                           value="{{ constituency.current_mp }}" placeholder="Enter MP name">
                </div>

                <div class="form-group">
                    <label for="cdf_office_email">CDF Office Email</label>
                    <input type="email" name="cdf_office_email" id="cdf_office_email" class="form-control" 
                           value="{{ constituency.cdf_office_email }}" placeholder="cdf@example.com">
                </div>

                <div class="form-group">
                    <label for="cdf_office_phone">CDF Office Phone</label>
                    <input type="tel" name="cdf_office_phone" id="cdf_office_phone" class="form-control" 
                           value="{{ constituency.cdf_office_phone }}" placeholder="+254XXXXXXXXX">
                </div>

                <div class="form-group full-width">
                    <label for="cdf_office_location">CDF Office Location/Address</label>
                    <textarea name="cdf_office_location" id="cdf_office_location" class="form-control" 
                              rows="3" placeholder="Enter office location">{{ constituency.cdf_office_location }}</textarea>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="icon-save"></i> Save Changes
                </button>
                <a href="{% url 'constituency_dashboard' %}" class="btn btn-secondary">
                    Cancel
                </a>
            </div>
        </form>
    </div>

    <!-- Constituency Information (Read-only) -->
    <div class="content-section">
        <h2>Constituency Information</h2>
        <div class="info-grid">
            <div class="info-item">
                <label>Constituency Name</label>
                <p>{{ constituency.name }}</p>
            </div>

            <div class="info-item">
                <label>Constituency Code</label>
                <p>{{ constituency.code }}</p>
            </div>

            <div class="info-item">
                <label>County</label>
                <p>{{ constituency.county.name }}</p>
            </div>

            {% if constituency.population %}
            <div class="info-item">
                <label>Population</label>
                <p>{{ constituency.population|intcomma }}</p>
            </div>
            {% endif %}

            <div class="info-item">
                <label>Number of Wards</label>
                <p>{{ constituency.wards.count }}</p>
            </div>

            <div class="info-item">
                <label>Status</label>
                <p>
                    {% if constituency.is_active %}
                    <span class="badge badge-success">Active</span>
                    {% else %}
                    <span class="badge badge-danger">Inactive</span>
                    {% endif %}
                </p>
            </div>
        </div>

        <div class="info-note">
            <p><strong>Note:</strong> To update constituency name, code, or other core information, please contact the system administrator.</p>
        </div>
    </div>

    <!-- CDF Budget Information (Read-only) -->
    <div class="content-section">
        <h2>CDF Budget Information</h2>
        <div class="info-grid">
            <div class="info-item">
                <label>Annual CDF Allocation</label>
                <p>KES {{ constituency.annual_cdf_allocation|floatformat:2|intcomma }}</p>
            </div>

            <div class="info-item">
                <label>CDF Bursary Allocation</label>
                <p>KES {{ constituency.cdf_bursary_allocation|floatformat:2|intcomma }}</p>
            </div>

            <div class="info-item">
                <label>Bursary Percentage</label>
                <p>
                    {% if constituency.annual_cdf_allocation > 0 %}
                    {{ constituency.cdf_bursary_allocation|floatformat:0|intcomma|div:constituency.annual_cdf_allocation|mul:100|floatformat:1 }}%
                    {% else %}
                    N/A
                    {% endif %}
                </p>
            </div>
        </div>

        <div class="info-note">
            <p><strong>Note:</strong> Budget allocations are set at the national level. Contact the CDF Board for budget adjustments.</p>
        </div>
    </div>

    <!-- Ward List -->
    <div class="content-section">
        <div class="section-header">
            <h2>Wards in {{ constituency.name }}</h2>
            <a href="{% url 'constituency_wards_overview' %}" class="btn btn-link">
                View Ward Details
            </a>
        </div>

        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Ward Name</th>
                        <th>Current MCA</th>
                        <th>Population</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ward in constituency.wards.all %}
                    <tr>
                        <td>{{ ward.name }}</td>
                        <td>{{ ward.current_mca|default:"N/A" }}</td>
                        <td>{{ ward.population|intcomma|default:"N/A" }}</td>
                        <td>
                            {% if ward.is_active %}
                            <span class="badge badge-success">Active</span>
                            {% else %}
                            <span class="badge badge-danger">Inactive</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- System Information -->
    <div class="content-section">
        <h2>System Information</h2>
        <div class="info-grid">
            <div class="info-item">
                <label>Your Role</label>
                <p>Constituency Administrator</p>
            </div>

            <div class="info-item">
                <label>Account Email</label>
                <p>{{ request.user.email }}</p>
            </div>

            <div class="info-item">
                <label>Account Phone</label>
                <p>{{ request.user.phone_number }}</p>
            </div>

            <div class="info-item">
                <label>Last Login</label>
                <p>{{ request.user.last_login|date:"M d, Y H:i" }}</p>
            </div>
        </div>

        <div class="system-actions">
            <a href="#" class="btn btn-secondary">
                <i class="icon-password"></i> Change Password
            </a>
            <a href="#" class="btn btn-secondary">
                <i class="icon-help"></i> Help & Support
            </a>
        </div>
    </div>
</div>

<style>
.form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
}

.form-group.full-width {
    grid-column: span 2;
}

.info-note {
    margin-top: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-left: 4px solid #0066cc;
}

.info-note p {
    margin: 0;
    color: #666;
}

.system-actions {
    margin-top: 20px;
    display: flex;
    gap: 15px;
}
</style>
{% endblock %}