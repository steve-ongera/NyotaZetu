{% extends 'admin_base.html' %}
{% load humanize %}

{% block title %}Ward Budget Allocations - {{ assigned_ward.name }} - Reviewer Panel{% endblock %}

{% block content %}
<div class="container-fluid">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{% url 'reviewer_dashboard' %}"><i class="bi bi-house-door"></i> Dashboard</a>
            </li>
            <li class="breadcrumb-item">
                <a href="{% url 'ward_profile' %}"><i class="bi bi-map-marked-alt"></i> Ward Profile</a>
            </li>
            <li class="breadcrumb-item active">Budget Allocations</li>
        </ol>
    </nav>

    <div class="section-container">
        <div class="page-header">
            <div>
                <h1 class="page-title">
                    <i class="bi bi-cash-stack"></i>
                    Ward Budget Allocations
                </h1>
                <p class="page-subtitle">{{ assigned_ward.name }} Ward - All Fiscal Years</p>
            </div>
        </div>

        {% if allocation_data %}
        <div class="allocations-list">
            {% for data in allocation_data %}
            <div class="allocation-item">
                <div class="allocation-year">
                    <h3>{{ data.allocation.fiscal_year.name }}</h3>
                    <span class="fiscal-period">
                        {{ data.allocation.fiscal_year.start_date|date:"M Y" }} - 
                        {{ data.allocation.fiscal_year.end_date|date:"M Y" }}
                    </span>
                </div>

                <div class="allocation-metrics">
                    <div class="metric-box">
                        <div class="metric-label">Total Allocated</div>
                        <div class="metric-value">KSh {{ data.allocation.allocated_amount|floatformat:0|intcomma }}</div>
                    </div>

                    <div class="metric-box">
                        <div class="metric-label">Amount Spent</div>
                        <div class="metric-value metric-success">
                            KSh {{ data.allocation.spent_amount|floatformat:0|intcomma }}
                        </div>
                    </div>

                    <div class="metric-box">
                        <div class="metric-label">Balance</div>
                        <div class="metric-value metric-info">
                            KSh {{ data.balance|floatformat:0|intcomma }}
                        </div>
                    </div>

                    <div class="metric-box">
                        <div class="metric-label">Beneficiaries</div>
                        <div class="metric-value">{{ data.allocation.beneficiaries_count|intcomma }}</div>
                    </div>
                </div>

                <div class="utilization-bar">
                    <div class="utilization-header">
                        <span>Utilization Rate</span>
                        <span class="utilization-percentage">{{ data.utilization_rate|floatformat:1 }}%</span>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar" style="width: {{ data.utilization_rate }}%"></div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon"><i class="bi bi-inbox"></i></div>
            <h3 class="empty-title">No Allocations Found</h3>
            <p class="empty-text">No budget allocations have been assigned to this ward yet.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}